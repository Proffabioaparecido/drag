<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Gondol Drag-and-Drop</title>

<style>
  body {
    font-family: sans-serif;
    text-align: center;
    background: #a7f3ff;
    margin: 0;
    padding-top: 10px;
    transition: background 0.5s;
  }

  h1 { 
    margin-bottom: 5px;
    color: #003e99;
    text-shadow: 0 0 8px white;
  }

  .info {
    display: flex;
    gap: 20px;
    margin-bottom: 10px;
    font-size: 24px;
    font-weight: bold;
    justify-content: center;
    color: #003e99;
  }

  .game-area {
    display: flex;
    justify-content: center;
    margin-top: 20px;
  }

  .container {
    display: grid;
    grid-template-columns: 40px repeat(3, 80px) 40px;
    grid-template-rows: 40px repeat(3, 80px) 40px;
    gap: 8px;
    background: #ffcf70;
    padding: 12px;
    border-radius: 12px;
    box-shadow: 4px 4px 10px rgba(0,0,0,.25);
    transition: background 0.5s;
  }

  .header, .footer, .side, .sideR {
    font-weight: bold;
    font-size: 26px;
    color: #003e99;
    text-shadow: 0 0 8px #ffffff;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .cell {
    width: 80px;
    height: 80px;
    background: #ffffff;
    border-radius: 10px;
    border: 3px solid #9bd6ff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 30px;
    color: #003e99;
    box-shadow: inset 2px 2px 4px rgba(0,0,0,.15);
    transition: background 0.5s, border 0.5s, color 0.5s;
  }

  .pieces-bottom {
    width: 100%;
    display: flex;
    justify-content: center;
    margin-top: 25px;
  }

  .pieces-box {
    background: #ffffff;
    padding: 10px 20px;
    border-radius: 12px;
    box-shadow: 4px 4px 10px rgba(0,0,0,.25);
  }

  #pieces {
    display: flex;
    flex-direction: row;
    gap: 10px;
    justify-content: center;
  }

  .piece {
    width: 55px;
    height: 55px;
    background: #7CFF8A;
    border-radius: 10px;
    border: 2px solid #2EBF4F;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    cursor: grab;
    color: #003e99;
    box-shadow: 2px 2px 6px rgba(0,0,0,.3);
  }

  button {
    padding: 8px 16px;
    font-size: 18px;
    background: #FF7A32;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin: 8px;
    box-shadow: 2px 2px 6px rgba(0,0,0,.25);
  }

  button:hover { background: #ff9c60; }

  #message {
    margin-top: 15px;
    font-size: 20px;
    font-weight: bold;
    color: #003e99;
  }

  select {
    padding: 6px 10px;
    font-size: 18px;
    border-radius: 6px;
    border: 2px solid #003e99;
    margin: 10px;
  }

  .modal-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,.5);
    display: none;
    align-items: center;
    justify-content: center;
  }

  .modal-box {
    background: white;
    padding: 25px;
    width: 350px;
    border-radius: 12px;
    text-align: left;
    box-shadow: 0 0 10px rgba(0,0,0,.5);
    font-size: 18px;
  }

  .modal-box h2 {
    margin-top: 0;
    text-align: center;
    color: #003e99;
  }

  /* Anima√ß√£o de vit√≥ria */
  @keyframes pulse {
    0% { transform: scale(1); background-color: #ffffff; }
    50% { transform: scale(1.2); background-color: #fffb7d; }
    100% { transform: scale(1); background-color: #ffffff; }
  }
  .win-cell {
    animation: pulse 0.5s ease-in-out 3;
  }

  .confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    background-color: #f00;
    top: -10px;
    opacity: 0.8;
    pointer-events: none;
    z-index: 9999;
    border-radius: 50%;
  }
</style>
</head>

<body>

<h1>GONDOL ‚Äì DRAG & DROP üé≤</h1>

<select id="levelSelect" onchange="newGame()">
  <option value="easy">Easy</option>
  <option value="medium" selected>Medium</option>
  <option value="hard">Hard</option>
</select>

<select id="themeSelect" onchange="applyTheme()">
  <option value="default">Default</option>
  <option value="pastel">Pastel Suave</option>
  <option value="gradient">Gradiente Premium</option>
</select>

<div class="info">
  <div>‚è±Ô∏è Time: <span id="tempo">0:00</span></div>
  <div>üèÜ Best: <span id="recorde">--</span></div>
</div>

<div class="game-area">
  <div class="container" id="container"></div>
</div>

<div class="pieces-bottom">
  <div class="pieces-box">
    <div id="pieces"></div>
  </div>
</div>

<button onclick="checkSolution()">Check</button>
<button onclick="newGame()">New Game</button>
<button onclick="resetPieces()">Reset Pieces</button>
<button onclick="openRules()">Rules</button>

<p id="message"></p>

<div class="modal-bg" id="rulesModal">
  <div class="modal-box">
    <h2>Rules</h2>
    <p>‚Ä¢ Drag the numbers 1‚Äì9 into the 3√ó3 grid.</p>
    <p>‚Ä¢ The sum of each row must match the target on the sides.</p>
    <p>‚Ä¢ The sum of each column must match the targets at the top/bottom.</p>
    <p>‚Ä¢ Use all numbers exactly once.</p>
    <p>‚Ä¢ Press ‚ÄúCheck‚Äù to verify your solution.</p>
    <button onclick="closeRules()">Close</button>
  </div>
</div>

<script>
let solution, board, rowTargets, colTargets;
let timerInterval, seconds=0;

/* Sons */
const soundPick = new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg");
const soundDrop = new Audio("https://actions.google.com/sounds/v1/cartoon/slide_whistle_to.ogg");

/* Timer */
function startTimer(){
  clearInterval(timerInterval);
  seconds = 0;
  timerInterval = setInterval(()=>{
    seconds++;
    const m = Math.floor(seconds/60);
    const s = seconds%60;
    document.getElementById("tempo").textContent = `${m}:${s.toString().padStart(2,'0')}`;
  }, 1000);
}

function updateBestTime(){
  const level = document.getElementById("levelSelect").value;
  const bestKey = `best_${level}`;
  const best = localStorage.getItem(bestKey);
  if(!best || seconds < best){
    localStorage.setItem(bestKey, seconds);
    document.getElementById("recorde").textContent = document.getElementById("tempo").textContent;
  }
}

/* Drag & Drop */
function allowDrop(ev){ ev.preventDefault(); }
function drag(ev){ ev.dataTransfer.setData("num", ev.target.id); soundPick.play(); }
function drop(ev){
  ev.preventDefault();
  const id = ev.dataTransfer.getData("num");
  const piece = document.getElementById(id);
  const r = ev.target.dataset.r;
  const c = ev.target.dataset.c;
  if(board[r][c] !== null) return;
  board[r][c] = parseInt(piece.textContent);
  ev.target.textContent = piece.textContent;
  piece.remove();
  soundDrop.play();
}

/* Banco de pe√ßas */
function createPieceBank(usedNumbers){
  const box = document.getElementById("pieces");
  box.innerHTML = "";
  for(let n=1; n<=9; n++){
    if(usedNumbers.includes(n)) continue;
    const p = document.createElement("div");
    p.className = "piece";
    p.id = "piece"+n;
    p.textContent = n;
    p.draggable = true;
    p.ondragstart = drag;
    box.appendChild(p);
  }
}

/* Cria tabuleiro */
function createBoard(){
  const cont = document.getElementById("container");
  cont.innerHTML = "";

  cont.appendChild(document.createElement("div"));
  colTargets.forEach(v=>{
    let d=document.createElement("div");
    d.className="header";
    d.textContent=v;
    cont.appendChild(d);
  });
  cont.appendChild(document.createElement("div"));

  for(let r=0; r<3; r++){
    let s=document.createElement("div");
    s.className="side";
    s.textContent=rowTargets[r];
    cont.appendChild(s);

    for(let c=0; c<3; c++){
      let cell=document.createElement("div");
      cell.className="cell";
      cell.dataset.r=r;
      cell.dataset.c=c;
      cell.ondragover = allowDrop;
      cell.ondrop = drop;
      if(board[r][c] !== null) cell.textContent = board[r][c];
      cont.appendChild(cell);
    }

    let s2=document.createElement("div");
    s2.className="sideR";
    s2.textContent=rowTargets[r];
    cont.appendChild(s2);
  }

  cont.appendChild(document.createElement("div"));
  colTargets.forEach(v=>{
    let d=document.createElement("div");
    d.className="footer";
    d.textContent=v;
    cont.appendChild(d);
  });
  cont.appendChild(document.createElement("div"));
}

/* Gera puzzle */
function generatePuzzle(){
  const nums = [1,2,3,4,5,6,7,8,9].sort(()=>Math.random()-0.5);
  solution = [ nums.slice(0,3), nums.slice(3,6), nums.slice(6,9) ];
  rowTargets = solution.map(r => r.reduce((a,b)=>a+b,0));
  colTargets = [0,1,2].map(c => solution[0][c]+solution[1][c]+solution[2][c]);
  board = Array(3).fill().map(()=>Array(3).fill(null));

  const level = document.getElementById("levelSelect").value;
  let positions = [];
  const indices = [0,1,2,3,4,5,6,7,8].sort(()=>Math.random()-0.5);

  if(level==="easy") positions = indices.slice(0,4);
  else if(level==="medium") positions = indices.slice(0,2);
  else positions = [];

  const flat = solution.flat();
  const used = [];
  positions.forEach(i=>{
    board[Math.floor(i/3)][i%3] = flat[i];
    used.push(flat[i]);
  });

  createPieceBank(used);
}

/* Anima√ß√£o vit√≥ria */
function playVictoryAnimation() {
  const cells = document.querySelectorAll('.cell');
  cells.forEach(cell => cell.classList.add('win-cell'));

  for (let i = 0; i < 50; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = Math.random() * window.innerWidth + 'px';
    confetti.style.backgroundColor = `hsl(${Math.random()*360}, 100%, 50%)`;
    document.body.appendChild(confetti);

    const fallDuration = 2000 + Math.random() * 2000;
    confetti.animate([
      { transform: `translateY(0px) rotate(0deg)` },
      { transform: `translateY(${window.innerHeight + 20}px) rotate(${Math.random()*360}deg)` }
    ], {
      duration: fallDuration,
      iterations: 1,
      easing: 'linear'
    });

    setTimeout(() => confetti.remove(), fallDuration);
  }

  const victorySound = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
  victorySound.play();
}

/* Verifica solu√ß√£o */
function checkSolution(){
  let correct = true;
  for(let r=0;r<3;r++)
    if(board[r].reduce((a,b)=>a+(b||0),0) !== rowTargets[r]) correct = false;
  for(let c=0;c<3;c++)
    if(board[0][c] + board[1][c] + board[2][c] !== colTargets[c]) correct = false;

  if(correct){
    clearInterval(timerInterval);
    updateBestTime();
    playVictoryAnimation();
  }

  document.getElementById("message").textContent =
    correct ? "üéâ Correct!" : "‚ùå Not yet!";
}

/* Resetar apenas pe√ßas */
function resetPieces(){
  const flat = solution.flat();
  board = Array(3).fill().map(()=>Array(3).fill(null));
  const level = document.getElementById("levelSelect").value;
  let positions = [];
  const indices = [0,1,2,3,4,5,6,7,8].sort(()=>Math.random()-0.5);

  if(level==="easy") positions = indices.slice(0,4);
  else if(level==="medium") positions = indices.slice(0,2);
  else positions = [];

  const used = [];
  positions.forEach(i=>{
    board[Math.floor(i/3)][i%3] = flat[i];
    used.push(flat[i]);
  });
  createPieceBank(used);
  createBoard();
  document.getElementById("message").textContent="";
}

/* Novo jogo */
function newGame(){
  clearInterval(timerInterval);
  seconds=0;
  document.getElementById("tempo").textContent="0:00";

  const level = document.getElementById("levelSelect").value;
  const bestKey = `best_${level}`;
  const best = localStorage.getItem(bestKey);
  document.getElementById("recorde").textContent = best ? 
      `${Math.floor(best/60)}:${(best%60).toString().padStart(2,'0')}` : "--";

  generatePuzzle();
  createBoard();
  document.getElementById("message").textContent="";
  startTimer();
  applyTheme();
}

/* Modal regras */
function openRules(){ document.getElementById("rulesModal").style.display="flex"; }
function closeRules(){ document.getElementById("rulesModal").style.display="none"; }

/* Temas din√¢micos */
function applyTheme(){
  const theme = document.getElementById("themeSelect").value;
  const container = document.getElementById("container");
  const cells = document.querySelectorAll(".cell");

  if(theme==="default"){
    container.style.background="#ffcf70";
    document.body.style.background="#a7f3ff";
    cells.forEach(c=>{
      c.style.background="#ffffff";
      c.style.border="3px solid #9bd6ff";
      c.style.color="#003e99";
    });
  } else if(theme==="pastel"){
    container.style.background="#ffdced";
    document.body.style.background="#ffe0f7";
    cells.forEach(c=>{
      c.style.background="#f4e8ff";
      c.style.border="3px solid #ff9bd6";
      c.style.color="#3d0066";
    });
  } else if(theme==="gradient"){
    container.style.background="linear-gradient(135deg, #6b73ff, #000dff)";
    document.body.style.background="#cce0ff";
    cells.forEach(c=>{
      c.style.background="#f7f7ff";
      c.style.border="3px solid #7c6fff";
      c.style.color="#001f66";
    });
  }
}

newGame();
</script>

</body>
</html>
